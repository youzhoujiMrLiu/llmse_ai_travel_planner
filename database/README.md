# æ•°æ®åº“è®¾ç½®æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

æœ¬æŒ‡å—å°†å¸®åŠ©ä½ åœ¨ Supabase ä¸­è®¾ç½®æ—…è¡Œè§„åˆ’åº”ç”¨æ‰€éœ€çš„æ•°æ®åº“è¡¨ã€‚

---

## ğŸ—„ï¸ æ•°æ®åº“è¡¨ç»“æ„

### 1. **travel_plans** (æ—…è¡Œè®¡åˆ’ä¸»è¡¨)
å­˜å‚¨ç”¨æˆ·çš„æ—…è¡Œè®¡åˆ’åŸºæœ¬ä¿¡æ¯

### 2. **plan_itinerary** (è¡Œç¨‹è¯¦ç»†å®‰æ’)
å­˜å‚¨æ¯ä¸ªæ—…è¡Œè®¡åˆ’çš„è¯¦ç»†è¡Œç¨‹å®‰æ’

### 3. **plan_expenses** (è´¹ç”¨è®°å½•)
å­˜å‚¨æ—…è¡Œè¿‡ç¨‹ä¸­çš„è´¹ç”¨è®°å½•

---

## ğŸš€ è®¾ç½®æ­¥éª¤

### æ­¥éª¤ 1: ç™»å½• Supabase

1. è®¿é—® [Supabase Dashboard](https://app.supabase.com/)
2. é€‰æ‹©ä½ çš„é¡¹ç›®

### æ­¥éª¤ 2: æ‰§è¡Œè¿ç§»è„šæœ¬

1. åœ¨å·¦ä¾§èœå•ä¸­ç‚¹å‡» **SQL Editor**
2. ç‚¹å‡» **New Query**
3. å¤åˆ¶ `migrations/001_create_travel_plans_tables.sql` æ–‡ä»¶çš„å†…å®¹
4. ç²˜è´´åˆ° SQL ç¼–è¾‘å™¨ä¸­
5. ç‚¹å‡» **Run** æŒ‰é’®æ‰§è¡Œ

### æ­¥éª¤ 3: éªŒè¯è¡¨åˆ›å»º

1. åœ¨å·¦ä¾§èœå•ä¸­ç‚¹å‡» **Table Editor**
2. ä½ åº”è¯¥èƒ½çœ‹åˆ°ä»¥ä¸‹è¡¨ï¼š
   - `travel_plans`
   - `plan_itinerary`
   - `plan_expenses`

### æ­¥éª¤ 4: éªŒè¯ RLS ç­–ç•¥

1. ç‚¹å‡»ä»»æ„è¡¨
2. ç‚¹å‡»é¡¶éƒ¨çš„ **RLS** é€‰é¡¹å¡
3. ç¡®è®¤ç­–ç•¥å·²å¯ç”¨ä¸”æ­£ç¡®é…ç½®

---

## ğŸ” Row Level Security (RLS)

æ‰€æœ‰è¡¨éƒ½å¯ç”¨äº† RLSï¼Œç¡®ä¿ï¼š
- âœ… ç”¨æˆ·åªèƒ½è®¿é—®è‡ªå·±çš„æ•°æ®
- âœ… æ•°æ®é€šè¿‡ `user_id` å…³è”åˆ° Supabase Auth
- âœ… å­è¡¨ï¼ˆitinerary, expensesï¼‰é€šè¿‡å¤–é”®éªŒè¯æƒé™

---

## ğŸ“Š å­—æ®µè¯´æ˜

### travel_plans è¡¨

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | UUID | ä¸»é”® |
| user_id | UUID | ç”¨æˆ·IDï¼ˆå…³è” auth.usersï¼‰ |
| destination | TEXT | ç›®çš„åœ° |
| start_date | DATE | å¼€å§‹æ—¥æœŸ |
| end_date | DATE | ç»“æŸæ—¥æœŸ |
| duration | INTEGER | å¤©æ•° |
| budget | NUMERIC(10,2) | é¢„ç®— |
| travelers | INTEGER | åŒè¡Œäººæ•° |
| preferences | TEXT[] | åå¥½æ ‡ç­¾æ•°ç»„ |
| status | TEXT | çŠ¶æ€ï¼šplanning/ongoing/completed |
| user_input | TEXT | ç”¨æˆ·åŸå§‹è¾“å…¥ |
| ai_generated_plan | JSONB | AI ç”Ÿæˆçš„è¡Œç¨‹ï¼ˆJSONï¼‰ |
| created_at | TIMESTAMPTZ | åˆ›å»ºæ—¶é—´ |
| updated_at | TIMESTAMPTZ | æ›´æ–°æ—¶é—´ |

### çŠ¶æ€è¯´æ˜

- **planning (è§„åˆ’ä¸­)**: å‡ºå‘æ—¥æœŸæœªåˆ°
- **ongoing (è¿›è¡Œä¸­)**: å½“å‰åœ¨æ—…è¡Œæ—¥æœŸèŒƒå›´å†…
- **completed (å·²å®Œæˆ)**: ç»“æŸæ—¥æœŸå·²è¿‡æˆ–æ‰‹åŠ¨æ ‡è®°å®Œæˆ

---

## ğŸ§ª æµ‹è¯•æ•°æ®ï¼ˆå¯é€‰ï¼‰

å¦‚éœ€æ’å…¥æµ‹è¯•æ•°æ®ï¼Œè¯·ï¼š

1. ä» Supabase Dashboard â†’ Authentication è·å–ä½ çš„ user_id
2. ç¼–è¾‘ SQL è„šæœ¬åº•éƒ¨çš„æµ‹è¯•æ•°æ®éƒ¨åˆ†
3. å°† `'your-user-id-here'` æ›¿æ¢ä¸ºå®é™…çš„ user_id
4. å–æ¶ˆæ³¨é‡Šå¹¶æ‰§è¡Œ

---

## ğŸ”— API ç«¯ç‚¹

åç«¯å·²åˆ›å»ºä»¥ä¸‹ API ç«¯ç‚¹ï¼š

| æ–¹æ³• | ç«¯ç‚¹ | è¯´æ˜ |
|------|------|------|
| GET | `/api/travel-plans` | è·å–ç”¨æˆ·æ‰€æœ‰è®¡åˆ’ |
| GET | `/api/travel-plans/:id` | è·å–å•ä¸ªè®¡åˆ’è¯¦æƒ… |
| POST | `/api/travel-plans` | åˆ›å»ºæ–°è®¡åˆ’ |
| PUT | `/api/travel-plans/:id` | æ›´æ–°è®¡åˆ’ |
| DELETE | `/api/travel-plans/:id` | åˆ é™¤è®¡åˆ’ |
| PATCH | `/api/travel-plans/:id/complete` | æ ‡è®°ä¸ºå·²å®Œæˆ |

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **ç¡®ä¿åç«¯ application.properties é…ç½®æ­£ç¡®**
   ```properties
   spring.datasource.url=jdbc:postgresql://your-project.supabase.co:5432/postgres
   spring.datasource.username=postgres
   spring.datasource.password=your-password
   ```

2. **çŠ¶æ€è‡ªåŠ¨æ›´æ–°**
   - åç«¯ä¼šæ ¹æ®å½“å‰æ—¥æœŸè‡ªåŠ¨æ›´æ–°è®¡åˆ’çŠ¶æ€
   - planning â†’ ongoing: å½“åˆ°è¾¾å¼€å§‹æ—¥æœŸæ—¶
   - ongoing â†’ completed: å½“è¶…è¿‡ç»“æŸæ—¥æœŸæ—¶

3. **æ•°æ®éªŒè¯**
   - æ‰€æœ‰å¿…å¡«å­—æ®µåœ¨åç«¯æœ‰éªŒè¯
   - æ—¥æœŸé€»è¾‘éªŒè¯ï¼ˆå¼€å§‹æ—¥æœŸä¸èƒ½æ—©äºä»Šå¤©ï¼‰
   - é¢„ç®—å’Œäººæ•°å¿…é¡»å¤§äº 0

---

## ğŸ“ é—®é¢˜æ’æŸ¥

### é—®é¢˜ 1: è¡¨åˆ›å»ºå¤±è´¥
**è§£å†³æ–¹æ¡ˆ**: æ£€æŸ¥æ˜¯å¦æœ‰è¯­æ³•é”™è¯¯ï¼Œç¡®ä¿ Supabase ç‰ˆæœ¬æ”¯æŒæ‰€æœ‰ SQL åŠŸèƒ½

### é—®é¢˜ 2: RLS ç­–ç•¥ä¸ç”Ÿæ•ˆ
**è§£å†³æ–¹æ¡ˆ**: ç¡®è®¤å·²å¯ç”¨ RLSï¼Œæ£€æŸ¥ç­–ç•¥ä¸­çš„ `auth.uid()` æ˜¯å¦æ­£ç¡®

### é—®é¢˜ 3: åç«¯æ— æ³•è¿æ¥æ•°æ®åº“
**è§£å†³æ–¹æ¡ˆ**: 
- æ£€æŸ¥ Supabase è¿æ¥å­—ç¬¦ä¸²
- ç¡®è®¤æ•°æ®åº“å¯†ç æ­£ç¡®
- æ£€æŸ¥é˜²ç«å¢™è®¾ç½®

---

## âœ… å®Œæˆæ£€æŸ¥æ¸…å•

- [ ] æ•°æ®åº“è¡¨å·²åˆ›å»º
- [ ] RLS ç­–ç•¥å·²å¯ç”¨
- [ ] åç«¯ä¾èµ–å·²æ·»åŠ 
- [ ] application.properties å·²é…ç½®
- [ ] å‰ç«¯ API å·²æ›´æ–°
- [ ] æµ‹è¯•åˆ›å»ºè®¡åˆ’åŠŸèƒ½

---

**ç¥ä½ ä½¿ç”¨æ„‰å¿«ï¼** ğŸ‰
